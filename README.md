# database
## Вариант 4 Khoroshilova M. Pavlova D. 19SE-1
### Уровень 1
1) Создаём таблицы
```sql
create table МЕДПЕРСОНАЛ
(
    ИДЕНТИФИКАТОР serial                                                 not null primary key,
    ФАМИЛИЯ       varchar(31)                                            not null,
    АДРЕС         varchar(255)                                           not null,
    "НАЛОГ, %"    smallint check ("НАЛОГ, %" >= 0 AND "НАЛОГ, %" <= 100) not null
);

create table "МЕСТО РАБОТЫ"
(
    ИДЕНТИФИКАТОР                    serial                                                   not null primary key,
    УЧРЕЖДЕНИЕ                       varchar(31)                                              not null,
    АДРЕС                            varchar(255)                                             not null,
    "ОТЧИСЛЕНИЕ В МЕСТНЫЙ БЮДЖЕТ, %" smallint check ("ОТЧИСЛЕНИЕ В МЕСТНЫЙ БЮДЖЕТ, %" >= 0 AND
                                                     "ОТЧИСЛЕНИЕ В МЕСТНЫЙ БЮДЖЕТ, %" <= 100) not null
);

create table "ТИПЫ ОПЕРАЦИЙ"
(
    ИДЕНТИФИКАТОР    serial                               not null primary key,
    НАИМЕНОВАНИЕ     varchar(255)                         not null,
    "ОПОРНЫЙ ПУНКТ"  varchar(255)                         not null,
    ЗАПАСЫ           integer check (ЗАПАСЫ > 0)           not null,
    "СТОИМОСТЬ, РУБ" integer check ("СТОИМОСТЬ, РУБ" > 0) not null
);

create table "ТРУДОВАЯ ДЕЯТЕЛЬНОСТЬ"
(
    ДОГОВОР        serial                            not null primary key,
    ДАТА           varchar(10)                       not null,
    "МЕД ПЕРСОНАЛ" serial                            not null references МЕДПЕРСОНАЛ (ИДЕНТИФИКАТОР),
    "МЕСТО РАБОТЫ" serial                            not null references "МЕСТО РАБОТЫ" (ИДЕНТИФИКАТОР),
    ОПЕРАЦИИ       serial                            not null references "ТИПЫ ОПЕРАЦИЙ" (ИДЕНТИФИКАТОР),
    "КОЛ-ВО"       smallint check ("КОЛ-ВО" > 0)     not null,
    "ОПЛАТА, РУБ"  integer check ("ОПЛАТА, РУБ" > 0) not null
);
```
2) Заполняем таблицы данными
```sql
INSERT INTO "МЕДПЕРСОНАЛ"("ИДЕНТИФИКАТОР", "ФАМИЛИЯ", "АДРЕС", "НАЛОГ, %")
VALUES (001, 'Медина', 'Вознесенское', 14),
       (002, 'Севастьянов',	'Навашино',	14),
       (003, 'Бессонов', 'Выкса', 10),
       (004, 'Губанов', 'Выкса', 10),
       (005, 'Боева', 'Починки', 5);

INSERT INTO "МЕСТО РАБОТЫ"("ИДЕНТИФИКАТОР", "УЧРЕЖДЕНИЕ", "АДРЕС", "ОТЧИСЛЕНИЕ В МЕСТНЫЙ БЮДЖЕТ, %")
VALUES (001, 'Районная больница', 'Вознесенское', 10),
       (002, 'Травм. пункт', 'Выкса', 3),
       (003, 'Больница', 'Навашино', 4),
       (004, 'Род. дом', 'Вознесенское', 12),
       (005, 'Больница', 'Починки',	4),
       (006, 'Травм.пункт',	'Лукояново', 3);

INSERT INTO "ТИПЫ ОПЕРАЦИЙ"("ИДЕНТИФИКАТОР", "НАИМЕНОВАНИЕ", "ОПОРНЫЙ ПУНКТ", "ЗАПАСЫ", "СТОИМОСТЬ, РУБ")
VALUES (001, 'Наложение гипса',	'Выкса', 2000, 18000),
       (002, 'Блокада',	'Навашино',	10000, 14000),
       (003, 'Инъекция поливитаминов', 'Навашино', 20000, 11000),
       (004, 'Инъекция алоэ', 'Навашино', 12000, 11000),
       (005, 'ЭКГ',	'Вознесенское',	115, 10000),
       (006, 'УЗИ',	'Вознесенское',	20,	30000),
       (007, 'Флюорография', 'Выкса', 1000, 5000);

INSERT INTO "ТРУДОВАЯ ДЕЯТЕЛЬНОСТЬ"("ДОГОВОР", "ДАТА", "МЕД ПЕРСОНАЛ", "МЕСТО РАБОТЫ", "ОПЕРАЦИИ", "КОЛ-ВО", "ОПЛАТА, РУБ")
VALUES (51040, 'Январь', 001, 001, 007,	4, 20000),
       (51041, 'Январь', 003, 003, 006,	1, 30000),
       (51042, 'Январь', 004, 003, 004,	3, 33000),
       (51043, 'Февраль', 004, 005,	001, 2, 36000),
       (51044, 'Февраль', 004,	004, 006, 1, 30000),
       (51045, 'Март', 002,	002, 005, 3, 30000),
       (51046, 'Март', 003,	006, 004, 4, 44000),
       (51047, 'Апрель', 004, 006, 002,	1, 28000),
       (51048, 'Апрель', 005, 003, 003,	4, 44000),
       (51049, 'Май', 002, 004,	005, 1, 10000),
       (51050, 'Май', 003, 006,	004, 2,	22000),
       (51051, 'Май', 003, 003,	001, 2,	36000),
       (51052, 'Июнь', 005, 003, 002, 1, 14000),
       (51053, 'Июль', 003,	002, 007, 2, 10000),
       (51054, 'Август', 004, 006, 004,	1, 11000),
       (51055, 'Август', 005, 005, 004,	2, 22000),
       (51056, 'Август', 003, 006, 003,	2, 22000);
```
3) Выводим таблицы:
```sql
SELECT *
FROM "МЕДПЕРСОНАЛ";
```
![image](https://user-images.githubusercontent.com/55359172/114346760-a3b12180-9b6c-11eb-961d-8ae840a7f7bc.png)
```sql
SELECT *
FROM "МЕСТО РАБОТЫ";
```
![image](https://user-images.githubusercontent.com/55359172/114346936-e115af00-9b6c-11eb-9c6a-943c5a939b36.png)
```sql
SELECT *
FROM "ТИПЫ ОПЕРАЦИЙ";
```
![image](https://user-images.githubusercontent.com/55359172/114347247-53868f00-9b6d-11eb-9c5a-f8a887f9c05c.png)

```sql
SELECT *
FROM "ТРУДОВАЯ ДЕЯТЕЛЬНОСТЬ";
```
![image](https://user-images.githubusercontent.com/55359172/114347366-7fa21000-9b6d-11eb-9a61-c0767cf0cb74.png)

4) Выводим с помощью запросов:
 * a) различные адреса всех медработников;
  ```sql
SELECT DISTINCT "АДРЕС" FROM "МЕДПЕРСОНАЛ";
  ```
![image](https://user-images.githubusercontent.com/55359172/114350123-72872000-9b71-11eb-80e0-84fc556cc7f6.png)

* b) список всех различных медучреждений;
```sql
SELECT DISTINCT "УЧРЕЖДЕНИЕ" FROM "МЕСТО РАБОТЫ";
```
 ![image](https://user-images.githubusercontent.com/55359172/114350427-da3d6b00-9b71-11eb-9cb1-c1303aa76fe7.png)

* c)	различные даты, для которых хранится информация о трудовой деятельности;
```sql
SELECT DISTINCT "ДАТА" FROM "ТРУДОВАЯ ДЕЯТЕЛЬНОСТЬ";
```
![image](https://user-images.githubusercontent.com/55359172/114350922-8e3ef600-9b72-11eb-8790-a49c6380f554.png)

6) На основании данных о проведенных операциях выводим в следующем формате все записи:
* a) дата, фамилия медперсонала, название места работы, название операции;
```sql
SELECT "ДАТА", "ФАМИЛИЯ", "МЕСТО РАБОТЫ"."УЧРЕЖДЕНИЕ", "НАИМЕНОВАНИЕ"
FROM "ТРУДОВАЯ ДЕЯТЕЛЬНОСТЬ","МЕДПЕРСОНАЛ","МЕСТО РАБОТЫ","ТИПЫ ОПЕРАЦИЙ"
WHERE "МЕДПЕРСОНАЛ"."ИДЕНТИФИКАТОР"="ТРУДОВАЯ ДЕЯТЕЛЬНОСТЬ"."МЕД ПЕРСОНАЛ"
  AND "ТРУДОВАЯ ДЕЯТЕЛЬНОСТЬ"."ОПЕРАЦИИ"="ТИПЫ ОПЕРАЦИЙ"."ИДЕНТИФИКАТОР"
  AND "ТРУДОВАЯ ДЕЯТЕЛЬНОСТЬ"."МЕСТО РАБОТЫ"="МЕСТО РАБОТЫ"."ИДЕНТИФИКАТОР";
```
![image](https://user-images.githubusercontent.com/55359172/114360622-eaf3de00-9b7d-11eb-870a-41a24eb14440.png)

* b) номер договора, название места работы, количество операций, оплата. Отсортировать по возрастанию оплаты.
```sql
SELECT DISTINCT "ДОГОВОР", "МЕСТО РАБОТЫ"."УЧРЕЖДЕНИЕ", "КОЛ-ВО", "ОПЛАТА, РУБ"
FROM "ТРУДОВАЯ ДЕЯТЕЛЬНОСТЬ","МЕДПЕРСОНАЛ","МЕСТО РАБОТЫ"
WHERE "ТРУДОВАЯ ДЕЯТЕЛЬНОСТЬ"."МЕСТО РАБОТЫ"="МЕСТО РАБОТЫ"."ИДЕНТИФИКАТОР"
ORDER BY "ОПЛАТА, РУБ" DESC;
```
![image](https://user-images.githubusercontent.com/55359172/114361267-9bfa7880-9b7e-11eb-97b5-8aac0da9d3e6.png)

8) Создаём запрос для модификации всех значений столбца с суммарной величиной оплаты, чтобы он содержал истинную сумму, получаемую медперсоналом ( за вычетом налога).
```sql
UPDATE "ТРУДОВАЯ ДЕЯТЕЛЬНОСТЬ"
SET "ОПЛАТА, РУБ" = "ТРУДОВАЯ ДЕЯТЕЛЬНОСТЬ"."ОПЛАТА, РУБ"/100 * (100 - "МЕДПЕРСОНАЛ"."НАЛОГ, %")
FROM "МЕДПЕРСОНАЛ" WHERE "ТРУДОВАЯ ДЕЯТЕЛЬНОСТЬ"."МЕД ПЕРСОНАЛ" = "МЕДПЕРСОНАЛ"."ИДЕНТИФИКАТОР";
```

Выводим новые значения.
```sql
SELECT *
FROM "ТРУДОВАЯ ДЕЯТЕЛЬНОСТЬ"
ORDER BY "ОПЛАТА, РУБ" DESC;
```
![image](https://user-images.githubusercontent.com/55359172/114363802-70c55880-9b81-11eb-83e4-973007ec3dbc.png)

9) Расширяем таблицу с данными об операциях столбцом, содержащим величину отчислений в местный бюджет для мед.учреждения, где проводилась операция. 
```sql
ALTER TABLE "ТРУДОВАЯ ДЕЯТЕЛЬНОСТЬ" ADD "ОТЧИСЛЕНИЯ В МЕСТНЫЙ БЮДЖЕТ, РУБ" INTEGER;

UPDATE "ТРУДОВАЯ ДЕЯТЕЛЬНОСТЬ"
SET "ОТЧИСЛЕНИЯ В МЕСТНЫЙ БЮДЖЕТ, РУБ" = "ТРУДОВАЯ ДЕЯТЕЛЬНОСТЬ"."ОПЛАТА, РУБ"/100 * ("МЕСТО РАБОТЫ"."ОТЧИСЛЕНИЕ В МЕСТНЫЙ БЮДЖЕТ, %")
FROM "МЕСТО РАБОТЫ" WHERE "ТРУДОВАЯ ДЕЯТЕЛЬНОСТЬ"."МЕСТО РАБОТЫ" = "МЕСТО РАБОТЫ"."ИДЕНТИФИКАТОР";
```

Создаём запрос для ввода конкретных значений во все строки таблицы операций.
```sql
SELECT *
FROM "ТРУДОВАЯ ДЕЯТЕЛЬНОСТЬ"
ORDER BY "ОПЛАТА, РУБ" DESC;
```
![image](https://user-images.githubusercontent.com/55359172/114369382-01eafe00-9b87-11eb-91eb-1b262203f320.png)
